<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Game Luyá»‡n Chuá»™t</title>

<style>
body{
  background:#111;
  color:white;
  text-align:center;
  font-family:Arial;
}
canvas{
  background:#222;
  cursor:none;
  display:block;
  margin:0 auto;
}
button{
  padding:10px 16px;
  margin:6px;
  font-size:15px;
  cursor:pointer;
}
#menu{
  margin-top:30px;
}
</style>
</head>

<body>

<h2>ğŸ¯ Game Luyá»‡n Chuá»™t</h2>

<div id="menu">
  <p>ğŸ® Chá»n cháº¿ Ä‘á»™</p>
  <button onclick="startGame(50,60)">Dá»… (50s â€“ 60Ä‘)</button><br>
  <button onclick="startGame(40,50)">Trung bÃ¬nh (40s â€“ 50Ä‘)</button><br>
  <button onclick="startGame(30,40)">KhÃ³ thÆ°á»ng (30s â€“ 40Ä‘)</button><br>
  <button onclick="startGame(20,30)">KhÃ³ (20s â€“ 30Ä‘)</button><br>
  <button onclick="startGame(10,20)">SiÃªu khÃ³ (10s â€“ 20Ä‘)</button><br>
  <button onclick="startGame(1,5)">ğŸ”¥ KhÃ³ khÃ³ khÃ³ thiÃªn tháº§n vÅ© trá»¥ Ä‘iá»‡n áº£nh (1s â€“ 5Ä‘)</button>
</div>

<p id="info" style="display:none;">
â± <span id="time">0</span>s |
â­ <span id="score">0</span> /
<span id="target">0</span> Ä‘iá»ƒm
</p>

<canvas id="game" width="700" height="400" style="display:none;"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const timeEl = document.getElementById("time");
const targetEl = document.getElementById("target");
const menu = document.getElementById("menu");
const info = document.getElementById("info");

let bubbles = [];
let score = 0;
let time = 0;
let target = 0;
let gameOver = false;
let spawnTimer;
let timeTimer;

// ===== Ã‚M THANH TING =====
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playTing(){
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = "sine";
  osc.frequency.value = 900;
  gain.gain.value = 0.15;

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.12);
}

// ===== CHUá»˜T + Vá»†T =====
let mouse = {x:0,y:0};
let mouseTrail = [];

canvas.addEventListener("mousemove", e=>{
  const r = canvas.getBoundingClientRect();
  mouse.x = e.clientX - r.left;
  mouse.y = e.clientY - r.top;

  mouseTrail.push({x:mouse.x,y:mouse.y});
  if(mouseTrail.length > 12) mouseTrail.shift();
});

function createBubble(){
  return {
    x:Math.random()*650+25,
    y:Math.random()*350+25,
    r:20,
    alpha:0,
    life:0
  };
}

function spawnBubbles(){
  let amount = Math.min(6,2+Math.floor(score/5));
  for(let i=0;i<amount;i++){
    bubbles.push(createBubble());
  }
}

function update(){
  if(gameOver) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // bong bÃ³ng
  bubbles.forEach((b,i)=>{
    b.life++;
    if(b.life < 40) b.alpha += 0.02;
    if(b.life > 120) b.alpha -= 0.02;

    if(b.alpha <= 0){
      bubbles.splice(i,1);
      return;
    }

    ctx.globalAlpha = b.alpha;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fillStyle="deepskyblue";
    ctx.fill();
    ctx.globalAlpha = 1;
  });

  // vá»‡t chuá»™t
  mouseTrail.forEach((p,i)=>{
    ctx.globalAlpha = i / mouseTrail.length;
    ctx.beginPath();
    ctx.arc(p.x,p.y,4,0,Math.PI*2);
    ctx.fillStyle="yellow";
    ctx.fill();
  });
  ctx.globalAlpha = 1;

  requestAnimationFrame(update);
}

canvas.addEventListener("click", e=>{
  const r = canvas.getBoundingClientRect();
  const mx = e.clientX - r.left;
  const my = e.clientY - r.top;

  bubbles.forEach((b,i)=>{
    const dx = mx - b.x;
    const dy = my - b.y;
    if(Math.sqrt(dx*dx+dy*dy) < b.r){
      score++;
      scoreEl.textContent = score;
      playTing();           // ğŸ”Š TING á» ÄÃ‚Y
      bubbles.splice(i,1);
    }
  });
});

function startGame(t, tg){
  menu.style.display="none";
  canvas.style.display="block";
  info.style.display="block";

  score = 0;
  time = t;
  target = tg;
  bubbles = [];
  mouseTrail = [];
  gameOver = false;

  scoreEl.textContent = 0;
  timeEl.textContent = time;
  targetEl.textContent = target;

  spawnTimer = setInterval(spawnBubbles,700);

  timeTimer = setInterval(()=>{
    time--;
    timeEl.textContent = time;
    if(time <= 0){
      endGame();
    }
  },1000);

  update();
}

function endGame(){
  gameOver = true;
  clearInterval(spawnTimer);
  clearInterval(timeTimer);

  let result = score >= target ? "ğŸ† HOÃ€N THÃ€NH Má»¤C TIÃŠU!" : "ğŸ˜¢ CHÆ¯A Äáº T";
  alert("Háº¿t giá»!\nÄiá»ƒm: "+score+" / "+target+"\n"+result);
}
</script>

</body>
</html>
